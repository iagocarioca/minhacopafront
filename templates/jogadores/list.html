{% extends "layout/base.html" %}
{% from "layout/card.html" import card %}
{% block breadcrumb %}Pelada • Jogadores{% endblock %}
{% block page_title %}Jogadores{% endblock %}
{% block content %}
<!-- Header com stats -->
<div class="grid grid-cols-2 gap-3 mb-6">
  <div class="rounded-lg bg-white/40 backdrop-blur-xl border border-slate-300/60 p-3.5">
    <div class="text-[10px] text-slate-500 mb-0.5 font-medium">Total de jogadores</div>
    <div class="text-xl font-medium text-slate-900">{{ data.meta.total or 0 }}</div>
  </div>
  <div class="rounded-lg bg-white/40 backdrop-blur-xl border border-slate-300/60 p-3.5">
    <div class="text-[10px] text-slate-500 mb-0.5 font-medium">Página</div>
    <div class="text-xl font-medium text-slate-900">{{ data.meta.page }}/{{ data.meta.total_pages }}</div>
  </div>
</div>

<div class="grid lg:grid-cols-2 gap-4">
  {% call card("Adicionar Jogador", "Pelada #" ~ pelada_id, "user-plus", "blue") %}
  <form method="post" 
        enctype="multipart/form-data"
        hx-post="{{ url_for('jogadores.list_create', pelada_id=pelada_id) }}"
        hx-target="#jogadores-list"
        hx-swap="innerHTML"
        hx-encoding="multipart/form-data"
        hx-on::after-request="if(event.detail.successful) { this.reset(); updateJogadoresCount(); lucide.createIcons(); }"
        class="space-y-3">
    <div>
      <label class="block text-xs font-semibold text-slate-700 mb-1.5">Nome completo</label>
      <input name="nome_completo" placeholder="Ex: João da Silva" required class="w-full text-sm px-4 py-2.5 rounded-lg bg-white/40 backdrop-blur-xl border border-slate-300/60 hover-border text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500/40 transition-all" />
    </div>
    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="block text-xs font-semibold text-slate-700 mb-1.5">Apelido</label>
        <input name="apelido" placeholder="Ex: João" class="w-full text-sm px-4 py-2.5 rounded-lg bg-white/40 backdrop-blur-xl border border-slate-300/60 hover-border text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500/40 transition-all" />
      </div>
      <div>
        <label class="block text-xs font-semibold text-slate-700 mb-1.5">Telefone</label>
        <input name="telefone" placeholder="(11) 99999-9999" class="w-full text-sm px-4 py-2.5 rounded-lg bg-white/40 backdrop-blur-xl border border-slate-300/60 hover-border text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500/40 transition-all" />
      </div>
    </div>
    <div>
      <label class="block text-xs font-semibold text-slate-700 mb-1.5">Foto (opcional)</label>
      <input type="file" name="foto" accept="image/png,image/jpeg,image/jpg,image/gif,image/webp" class="w-full text-sm px-4 py-2.5 rounded-lg bg-white/40 backdrop-blur-xl text-slate-900 file:mr-4 file:py-1.5 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-medium file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100" />
    </div>
    <button type="submit" class="w-full h-11 rounded-lg bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white text-sm font-semibold transition-all inline-flex items-center justify-center gap-2">
      <i data-lucide="user-plus" class="w-4 h-4"></i>
      Adicionar jogador
    </button>
  </form>
  {% endcall %}

  {% call card("Jogadores", data.data|length ~ " jogadores na lista", "users", "purple") %}
  <div class="space-y-2" id="jogadores-list">
    {% include "jogadores/_jogadores_list.html" %}
  </div>
    {% endcall %}
</div>

<script>
function updateJogadoresCount() {
  const list = document.getElementById('jogadores-list');
  if (!list) return;
  
  const jogadores = list.querySelectorAll('.rounded-lg.border');
  const count = jogadores.length;
  
  // Atualiza o subtítulo do card e o total no header
  const card = list.closest('.rounded-md');
  if (card) {
    const subtitle = card.querySelector('.text-xs.text-slate-500');
    if (subtitle) {
      subtitle.textContent = count + ' jogador' + (count !== 1 ? 'es' : '') + ' na lista';
    }
  }
  
  // Atualiza o total no header
  const totalElement = document.querySelector('.text-xl.font-medium.text-slate-900');
  if (totalElement && count > 0) {
    // Não atualizamos o total do meta porque pode ter paginação
    // Mas podemos atualizar visualmente se necessário
  }
}

// Inicializa o contador ao carregar
document.addEventListener('DOMContentLoaded', function() {
  updateJogadoresCount();
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }
});
</script>
{% endblock %}
