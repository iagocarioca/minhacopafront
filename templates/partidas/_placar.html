{% set casa = partida.time_casa_full or partida.time_casa or {} %}
{% set fora = partida.time_fora_full or partida.time_fora or {} %}

<!-- Placar (minimalista) -->
<div class="rounded-lg bg-white/60 backdrop-blur-xl border border-slate-300/60 overflow-hidden">
  <!-- Header -->
  <div class="px-5 pt-5 pb-4 border-b border-slate-200/50">
    <div class="text-[11px] font-semibold text-slate-500 uppercase tracking-wider mb-1">
      {% if partida.rodada and partida.rodada.nome %}{{ partida.rodada.nome }}{% else %}Partida{% endif %}
    </div>
    <div class="text-xs text-slate-600">
      {% if partida.inicio %}{{ partida.inicio | data_br(True) }}{% else %}Agendada{% endif %}
    </div>
  </div>

  <!-- Placar principal -->
  <div class="px-5 py-6">
    <div class="flex items-center justify-between gap-3">
      <!-- Time Casa -->
      <div class="flex-1 text-center min-w-0">
        <!-- Escudo (quadrado arredondado) -->
        <div class="w-14 h-14 sm:w-16 sm:h-16 mx-auto mb-2 rounded-xl bg-white/80 backdrop-blur-xl grid place-items-center border border-slate-300/60 overflow-hidden">
          {% if casa.escudo_url %}
            <img src="http://192.168.18.162:5001{{ casa.escudo_url }}" alt="{{ casa.nome }}" class="w-full h-full object-cover" />
          {% elif casa.nome %}
            <span class="text-slate-900 font-semibold text-base">{{ (casa.nome[0:2] if casa.nome|length > 2 else casa.nome[0]) | upper }}</span>
          {% else %}
            <i data-lucide="shirt" class="w-7 h-7 text-slate-500"></i>
          {% endif %}
        </div>
        <!-- Nome do time -->
        <div class="text-sm font-semibold text-slate-900 mb-0.5 truncate">{{ casa.nome or "Casa" }}</div>
        <div class="text-[11px] text-slate-500">Casa</div>
      </div>

      <!-- Score -->
      <div class="flex flex-col items-center justify-center">
        <div class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-900 text-white shadow-sm">
          <span class="text-3xl sm:text-4xl font-semibold leading-none tabular-nums">{{ partida.gols_casa or 0 }}</span>
          <span class="text-sm text-white/70">:</span>
          <span class="text-3xl sm:text-4xl font-semibold leading-none tabular-nums">{{ partida.gols_fora or 0 }}</span>
        </div>
        {% if partida.status == 'em_andamento' %}
          <div class="mt-2 text-[11px] text-slate-600 font-medium">
            {% if partida.gols and partida.gols|length %}
              {% set ultimo_gol = partida.gols[-1] %}
              {% if ultimo_gol.minuto %}{{ ultimo_gol.minuto }}'{% endif %}
            {% else %}
              Em andamento
            {% endif %}
          </div>
        {% elif partida.status == 'finalizada' %}
          <div class="mt-2 text-[11px] text-slate-600 font-medium">Finalizada</div>
        {% else %}
          <div class="mt-2 text-[11px] text-slate-600 font-medium">Agendada</div>
        {% endif %}
      </div>

      <!-- Time Fora -->
      <div class="flex-1 text-center min-w-0">
        <!-- Escudo (quadrado arredondado) -->
        <div class="w-14 h-14 sm:w-16 sm:h-16 mx-auto mb-2 rounded-xl bg-white/80 backdrop-blur-xl grid place-items-center border border-slate-300/60 overflow-hidden">
          {% if fora.escudo_url %}
            <img src="http://192.168.18.162:5001{{ fora.escudo_url }}" alt="{{ fora.nome }}" class="w-full h-full object-cover" />
          {% elif fora.nome %}
            <span class="text-slate-900 font-semibold text-base">{{ (fora.nome[0:2] if fora.nome|length > 2 else fora.nome[0]) | upper }}</span>
          {% else %}
            <i data-lucide="shirt" class="w-7 h-7 text-slate-500"></i>
          {% endif %}
        </div>
        <!-- Nome do time -->
        <div class="text-sm font-semibold text-slate-900 mb-0.5 truncate">{{ fora.nome or "Fora" }}</div>
        <div class="text-[11px] text-slate-500">Visitante</div>
      </div>
    </div>
  </div>

  <!-- Gols marcados (se houver) -->
  {% if partida.gols and partida.gols|length %}
    {% from "layout/soccer_ball_icon.html" import soccer_ball_icon %}
    <div class="px-5 pb-5 pt-3 border-t border-slate-200/50">
      <div class="space-y-2">
        {% for g in partida.gols[:5] %}
          <div class="flex items-center justify-center gap-2 text-xs text-slate-700">
            {{ soccer_ball_icon("w-3 h-3", "currentColor", "flex-shrink-0") }}
            <span class="font-semibold">
              {% if g.minuto is not none %}{{ g.minuto }}'{% endif %}
            </span>
            <span>{{ (g.jogador.apelido if g.jogador else None) or (g.jogador.nome_completo if g.jogador else None) or "Jogador" }}</span>
            {% if g.gol_contra %}<span class="text-rose-600">(GC)</span>{% endif %}
          </div>
        {% endfor %}
        {% if partida.gols|length > 5 %}
          <div class="text-xs text-slate-500 text-center">+{{ partida.gols|length - 5 }} mais</div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <!-- Botões de ação -->
  {% if partida.status == "agendada" or partida.status == "em_andamento" %}
    <div class="px-5 pb-5 pt-3 border-t border-slate-200/50">
      <div class="grid grid-cols-2 gap-3">
        {% if partida.status == "agendada" %}
          <form method="post" action="/partidas/{{partida.id}}/iniciar">
            <button class="w-full h-10 rounded-md bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-semibold transition-all inline-flex items-center justify-center gap-2">
              <i data-lucide="play" class="w-3.5 h-3.5"></i>
              Iniciar
            </button>
          </form>
        {% endif %}
        {% if partida.status == "em_andamento" %}
          <form method="post" action="/partidas/{{partida.id}}/finalizar">
            <button class="w-full h-10 rounded-md bg-slate-900 hover:bg-slate-800 text-white text-xs font-semibold transition-all inline-flex items-center justify-center gap-2">
              <i data-lucide="stop-circle" class="w-3.5 h-3.5"></i>
              Finalizar
            </button>
          </form>
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>
