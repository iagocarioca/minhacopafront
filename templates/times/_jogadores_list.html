{% for j in time.jogadores or [] %}
  <div class="group rounded-xl bg-white/60 backdrop-blur-xl border border-slate-300/60 hover:border-slate-400/60 hover:shadow-md p-4 transition-all w-full max-w-full">
    <div class="flex items-start gap-3 w-full max-w-full">
      <!-- Foto do Jogador -->
      <div class="flex-shrink-0">
        {% if j.foto_url %}
          <img src="/media/{{ j.foto_url[1:] if j.foto_url.startswith('/') else j.foto_url }}" alt="{{ j.apelido or j.nome_completo }}" class="w-12 h-12 rounded-xl object-cover border-2 border-slate-300/60 shadow-sm" />
        {% else %}
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 grid place-items-center shadow-sm">
            <i data-lucide="user" class="w-6 h-6 text-white"></i>
          </div>
        {% endif %}
      </div>
      <!-- Info do Jogador -->
      <div class="flex-1 min-w-0 max-w-full">
        <div class="flex items-center justify-between gap-2 mb-1.5 w-full max-w-full">
          <div class="text-base font-bold text-slate-900 truncate flex-1 min-w-0 max-w-full">{{ j.apelido or j.nome_completo }}</div>
          <!-- Botões de ação (ao lado do nome) -->
          <div class="flex items-center gap-1.5 flex-shrink-0">
            <!-- Botão Editar/Salvar (muda conforme estado) -->
            <button 
              type="button" 
              id="btn-edit-{{ j.id }}"
              onclick="toggleEditJogador({{ j.id }})" 
              class="w-8 h-8 rounded-lg bg-white/80 border border-slate-300/60 hover:bg-blue-50 hover:border-blue-300/60 text-slate-700 hover:text-blue-700 transition-all inline-flex items-center justify-center flex-shrink-0" 
              title="Editar posição"
            >
              <i data-lucide="pencil" class="w-4 h-4"></i>
            </button>
            <!-- Botão Remover -->
            <form method="post" 
                  hx-post="{{ url_for('times.detalhe', time_id=time.id) }}"
                  hx-target="#jogadores-list"
                  hx-swap="innerHTML"
                  hx-on--after-swap="updateJogadoresCount()"
                  class="flex-shrink-0">
              <input type="hidden" name="action" value="remove">
              <input type="hidden" name="jogador_id" value="{{ j.id }}">
              <button type="submit" class="w-8 h-8 rounded-lg bg-white/80 border border-slate-300/60 hover:bg-rose-50 hover:border-rose-300/60 text-slate-700 hover:text-rose-700 transition-all inline-flex items-center justify-center flex-shrink-0" title="Remover jogador">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </form>
          </div>
        </div>
        <!-- Formulário de edição (inicialmente oculto) -->
        <div id="edit-form-{{ j.id }}" class="hidden mb-2">
          <form method="post" 
                id="form-edit-{{ j.id }}"
                hx-post="{{ url_for('times.detalhe', time_id=time.id) }}"
                hx-target="#jogadores-list"
                hx-swap="innerHTML"
                hx-on--after-swap="updateJogadoresCount()"
                class="flex items-center gap-2">
            <input type="hidden" name="action" value="update">
            <input type="hidden" name="jogador_id" value="{{ j.id }}">
            <input 
              type="text" 
              name="posicao" 
              id="input-posicao-{{ j.id }}"
              value="{{ j.posicao or '' }}" 
              placeholder="Ex: Atacante, Goleiro..." 
              class="flex-1 text-sm px-3 py-2 rounded-lg bg-white/80 border border-slate-300/60 hover:border-slate-400/60 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50 transition-all"
            />
          </form>
        </div>
        <div class="flex items-center gap-2 flex-wrap w-full max-w-full">
          {% if j.capitao %}
            <span class="inline-flex items-center gap-1.5 text-[11px] px-2.5 py-1 rounded-full bg-yellow-50/80 border border-yellow-300/60 text-yellow-700 font-semibold whitespace-nowrap flex-shrink-0">
              <i data-lucide="star" class="w-3.5 h-3.5 fill-yellow-500"></i>
              Capitão
            </span>
          {% endif %}
          {% if j.posicao %}
            <span class="inline-flex items-center text-[11px] px-2.5 py-1 rounded-full bg-slate-100/80 border border-slate-300/60 text-slate-700 font-medium whitespace-nowrap flex-shrink-0">
              {{ j.posicao }}
            </span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% else %}
  <div class="col-span-full text-center py-12">
    <div class="mb-4 inline-flex items-center justify-center w-16 h-16 rounded-xl bg-blue-50/70 border border-blue-300/60 text-blue-600">
      <i data-lucide="users" class="w-8 h-8"></i>
    </div>
    <div class="text-base text-slate-800 font-semibold mb-1">Nenhum jogador escalado</div>
    <div class="text-sm text-slate-500">Adicione jogadores ao time usando o botão acima.</div>
  </div>
{% endfor %}

