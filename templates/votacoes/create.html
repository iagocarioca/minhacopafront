{% extends "layout/base.html" %} {% from "layout/card.html" import card %} {% block breadcrumb %}Rodada ‚Ä¢ Vota√ß√µes{% endblock %} {% block page_title %}Vota√ß√µes{% endblock %} {% block content %} {% call card("Criar vota√ß√£o", "Nova vota√ß√£o da rodada", "vote", "blue") %} <form method="post" class="space-y-3" onsubmit="return buildVotacaoIso();"> <div> <label class="block text-xs font-semibold text-slate-700 mb-1.5">Tipo</label> <input name="tipo" placeholder="Ex: MVP" class="w-full text-sm px-4 py-3 rounded-md bg-white/60 backdrop-blur-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500/30" /> </div> <input type="hidden" id="abre_em" name="abre_em" /> <input type="hidden" id="fecha_em" name="fecha_em" /> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3"> <div> <label class="block text-xs font-semibold text-slate-700 mb-1.5">In√≠cio <span class="text-emerald-600">üü¢</span></label> <div class="grid grid-cols-2 gap-2"> <input id="abre_date" type="date" required class="w-full text-sm px-3 py-3 rounded-md bg-white/60 backdrop-blur-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary-500/30" /> <input id="abre_time" type="time" required class="w-full text-sm px-3 py-3 rounded-md bg-white/60 backdrop-blur-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary-500/30" /> </div> </div> <div> <label class="block text-xs font-semibold text-slate-700 mb-1.5">Fim <span class="text-rose-600">üî¥</span></label> <div class="grid grid-cols-2 gap-2"> <input id="fecha_date" type="date" required class="w-full text-sm px-3 py-3 rounded-md bg-white/60 backdrop-blur-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary-500/30" /> <input id="fecha_time" type="time" required class="w-full text-sm px-3 py-3 rounded-md bg-white/60 backdrop-blur-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary-500/30" /> </div> </div> </div> <div class="grid grid-cols-3 gap-2"> <button type="button" onclick="setAbrirAgora()" class="h-11 rounded-md bg-emerald-50/80 hover:bg-emerald-50 text-xs font-medium text-emerald-700 inline-flex items-center justify-center gap-2 transition-all "> <i data-lucide="clock" class="w-3.5 h-3.5"></i> <span>Agora</span> </button> <button type="button" onclick="setFecharEm2h()" class="h-11 rounded-md bg-orange-50/80 hover:bg-orange-50 text-xs font-medium text-orange-700 inline-flex items-center justify-center gap-2 transition-all "> <i data-lucide="timer" class="w-3.5 h-3.5"></i> <span>+2h</span> </button> <button type="button" onclick="setFecharAmanha()" class="h-11 rounded-md bg-blue-50/80 hover:bg-blue-50 text-xs font-medium text-blue-700 inline-flex items-center justify-center gap-2 transition-all "> <i data-lucide="calendar" class="w-3.5 h-3.5"></i> <span>Amanh√£</span> </button> </div> <div class="text-xs text-slate-600 bg-blue-50/60 backdrop-blur-xl rounded-md p-4 "> <div class="flex items-start gap-2"> <i data-lucide="info" class="w-4 h-4 mt-0.5"></i> <div class="flex-1"> <div class="font-semibold text-slate-800 mb-2">‚ö†Ô∏è A vota√ß√£o s√≥ aceita votos dentro do per√≠odo configurado</div> <div class="space-y-1"> <div><span class="text-slate-500">Ser√° enviado:</span> <span id="preview_abre" class="text-emerald-600">‚Äî</span></div> <div><span class="text-slate-500">at√©:</span> <span id="preview_fecha" class="text-rose-600">‚Äî</span></div> </div> <div class="mt-3 pt-2 border-t border-slate-300/60"> <label class="flex items-center gap-2 cursor-pointer group"> <input type="checkbox" id="use_utc" class="rounded border-slate-300 text-primary-600 focus:ring-primary-500/20"> <span class="text-[11px] text-slate-600 transition-colors"> üåê Converter para UTC (se o servidor usar UTC) </span> </label> </div> <div class="mt-2 text-[11px] text-slate-500">üí° Use os bot√µes r√°pidos ou ajuste manualmente</div> </div> </div> </div> <button class="w-full h-12 rounded-md bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white text-sm font-semibold transition-all inline-flex items-center justify-center gap-2 "> <i data-lucide="plus" class="w-4 h-4"></i> Criar </button> <div class="text-xs text-slate-500 text-center mt-2">Ao criar, vamos gerar e mostrar o link da vota√ß√£o.</div> </form> {% endcall %} {% if created_id %} {% set created_path = "/votacoes/" ~ created_id ~ "/votar?rodada_id=" ~ rodada_id %} {% call card("üéâ Vota√ß√£o Criada!", "Sua vota√ß√£o foi criada com sucesso", "check-circle", "green") %} <div class="space-y-3"> <div class="grid grid-cols-2 gap-2"> <a href="{{ created_path }}" class="h-12 rounded-md bg-blue-50/80 hover:bg-blue-50 text-sm font-medium text-blue-700 inline-flex items-center justify-center gap-2 transition-all "> <i data-lucide="check-square" class="w-4 h-4"></i> Votar </a> <a href="{{ url_for('votacoes.resultado', votacao_id=created_id, rodada_id=rodada_id) }}" class="h-12 rounded-md bg-emerald-50/80 hover:bg-emerald-50 text-sm font-medium text-emerald-700 inline-flex items-center justify-center gap-2 transition-all "> <i data-lucide="trophy" class="w-4 h-4"></i> Resultado </a> </div> <div class="flex gap-2"> <input id="created_link" readonly value="{{ request.url_root.rstrip('/') ~ created_path }}" class="flex-1 text-sm px-4 py-3 rounded-md bg-white/60 backdrop-blur-xl text-slate-900 font-mono text-xs " /> <button type="button" onclick="copyCreatedLink()" class="h-12 px-5 rounded-md bg-white/60 backdrop-blur-xl hover:bg-white/80 text-sm font-medium text-slate-700 inline-flex items-center gap-2 transition-all "> <i data-lucide="copy" class="w-4 h-4"></i> Copiar </button> </div> </div> {% endcall %} {% endif %} {% if recent_votacoes %} {% call card("Vota√ß√µes criadas recentemente", "√öltimas " ~ (recent_votacoes|length), "clock", "purple") %} <div class="space-y-2"> {% for v in recent_votacoes %} {% set p = "/votacoes/" ~ v.id ~ "/votar?rodada_id=" ~ v.rodada_id %} <div class="rounded-md bg-white/60 backdrop-blur-xl hover: px-4 py-4 flex items-start justify-between gap-3 transition-all"> <div class="flex-1 min-w-0"> <div class="text-sm font-semibold text-slate-900">{{ v.tipo or "Vota√ß√£o" }}</div> <div class="text-xs text-slate-500 mt-1">{{ v.tipo or "Vota√ß√£o" }}</div> {% if v.abre_em and v.fecha_em %} <div class="text-[11px] text-slate-500 mt-1">{{ v.abre_em | data_br(True) }} ‚Üí {{ v.fecha_em | data_br(True) }}</div> {% endif %} </div> <div class="flex gap-2"> <a href="{{ url_for('votacoes.resultado', votacao_id=v.id, rodada_id=v.rodada_id) }}" class="h-10 px-3 rounded-md bg-emerald-50/80 hover:bg-emerald-50 text-xs font-medium text-emerald-700 inline-flex items-center gap-1.5 transition-all" title="Ver resultado"> <i data-lucide="trophy" class="w-3.5 h-3.5"></i> </a> <a href="{{ p }}" class="h-10 px-3 rounded-md bg-white/80 hover:bg-white text-xs font-medium text-slate-700 inline-flex items-center gap-2 transition-all"> <i data-lucide="check-square" class="w-3.5 h-3.5"></i> Votar </a> </div> </div> {% endfor %} </div> {% endcall %} {% endif %} {% call card("üéØ Acesso R√°pido", "Links √∫teis", "zap", "yellow") %} <div class="grid grid-cols-1 sm:grid-cols-2 gap-2"> <a href="{{ url_for('votacoes.resultados_rodada', rodada_id=rodada_id) }}" class="h-12 rounded-md bg-purple-50/80 hover:bg-purple-50 text-sm font-medium text-purple-700 inline-flex items-center justify-center gap-2 transition-all "> <i data-lucide="trophy" class="w-4 h-4"></i> Ver Todos os Resultados </a> <button type="button" onclick="abrirVotacaoPorId()" class="h-12 rounded-md bg-white/60 backdrop-blur-xl hover:bg-white/80 text-sm font-medium text-slate-700 inline-flex items-center justify-center gap-2 transition-all "> <i data-lucide="hash" class="w-4 h-4"></i> Abrir por n√∫mero </button> </div> {% endcall %} <script> function abrirVotacaoPorId() { const id = prompt("Digite o n√∫mero da vota√ß√£o:"); if (id) { window.location = `/votacoes/${id}/votar?rodada_id={{ rodada_id }}`; } } </script> <script> function buildApiDatetime(d, t, convertToUTC = false) { if (!convertToUTC) { return `${d} ${t}:00`; } const localDate = new Date(`${d}T${t}:00`); const year = localDate.getUTCFullYear(); const month = String(localDate.getUTCMonth() + 1).padStart(2, '0'); const day = String(localDate.getUTCDate()).padStart(2, '0'); const hours = String(localDate.getUTCHours()).padStart(2, '0'); const minutes = String(localDate.getUTCMinutes()).padStart(2, '0'); return `${year}-${month}-${day} ${hours}:${minutes}:00`; } function updatePreview() { const abreDate = document.getElementById("abre_date")?.value; const abreTime = document.getElementById("abre_time")?.value; const fechaDate = document.getElementById("fecha_date")?.value; const fechaTime = document.getElementById("fecha_time")?.value; const useUTC = document.getElementById("use_utc")?.checked || false; if (!abreDate || !abreTime || !fechaDate || !fechaTime) { const pa = document.getElementById("preview_abre"); const pf = document.getElementById("preview_fecha"); if (pa) pa.textContent = "‚Äî"; if (pf) pf.textContent = "‚Äî"; return; } const abre = buildApiDatetime(abreDate, abreTime, useUTC); const fecha = buildApiDatetime(fechaDate, fechaTime, useUTC); const pa = document.getElementById("preview_abre"); const pf = document.getElementById("preview_fecha"); if (pa) pa.textContent = abre + (useUTC ? ' (UTC)' : ' (local)'); if (pf) pf.textContent = fecha + (useUTC ? ' (UTC)' : ' (local)'); } function buildVotacaoIso() { updatePreview(); const abreDate = document.getElementById("abre_date")?.value; const abreTime = document.getElementById("abre_time")?.value; const fechaDate = document.getElementById("fecha_date")?.value; const fechaTime = document.getElementById("fecha_time")?.value; const useUTC = document.getElementById("use_utc")?.checked || false; if (!abreDate || !abreTime || !fechaDate || !fechaTime) { alert("‚ö†Ô∏è Selecione data e hor√°rio de in√≠cio e fim."); return false; } const abreTimestamp = new Date(`${abreDate}T${abreTime}`).getTime(); const fechaTimestamp = new Date(`${fechaDate}T${fechaTime}`).getTime(); if (fechaTimestamp <= abreTimestamp) { alert("‚ö†Ô∏è A data/hora de FIM deve ser posterior √† de IN√çCIO."); return false; } const now = new Date().getTime(); const diffMinutes = Math.floor((abreTimestamp - now) / 60000); if (!useUTC && abreTimestamp < now - 60000) { if (!confirm(`‚ö†Ô∏è A vota√ß√£o vai abrir no PASSADO (${Math.abs(diffMinutes)} min atr√°s).\n\nIsso pode causar erro "Vota√ß√£o n√£o est√° aberta".\n\nDeseja continuar mesmo assim?`)) { return false; } } const abre = buildApiDatetime(abreDate, abreTime, useUTC); const fecha = buildApiDatetime(fechaDate, fechaTime, useUTC); const hidA = document.getElementById("abre_em"); const hidF = document.getElementById("fecha_em"); if (hidA) hidA.value = abre; if (hidF) hidF.value = fecha; console.log('‚úÖ Enviando:', { abre, fecha, useUTC }); return true; } function copyCreatedLink() { const el = document.getElementById("created_link"); if (!el) return; el.select(); el.setSelectionRange(0, 99999); try { navigator.clipboard.writeText(el.value); } catch (e) { document.execCommand("copy"); } } function formatDateForInput(date) { const year = date.getFullYear(); const month = String(date.getMonth() + 1).padStart(2, '0'); const day = String(date.getDate()).padStart(2, '0'); return `${year}-${month}-${day}`; } function formatTimeForInput(date) { const hours = String(date.getHours()).padStart(2, '0'); const minutes = String(date.getMinutes()).padStart(2, '0'); return `${hours}:${minutes}`; } function setAbrirAgora() { const now = new Date(); const date = formatDateForInput(now); const time = formatTimeForInput(now); const dateEl = document.getElementById("abre_date"); const timeEl = document.getElementById("abre_time"); if (dateEl) dateEl.value = date; if (timeEl) timeEl.value = time; console.log('üü¢ Abre agora:', date, time); updatePreview(); } function setFecharEm2h() { const future = new Date(); future.setHours(future.getHours() + 2); const date = formatDateForInput(future); const time = formatTimeForInput(future); const dateEl = document.getElementById("fecha_date"); const timeEl = document.getElementById("fecha_time"); if (dateEl) dateEl.value = date; if (timeEl) timeEl.value = time; console.log('üî¥ Fecha em 2h:', date, time); updatePreview(); } function setFecharAmanha() { const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate() + 1); tomorrow.setHours(23, 59, 0, 0); const date = formatDateForInput(tomorrow); const time = formatTimeForInput(tomorrow); const dateEl = document.getElementById("fecha_date"); const timeEl = document.getElementById("fecha_time"); if (dateEl) dateEl.value = date; if (timeEl) timeEl.value = time; console.log('üìÖ Fecha amanh√£:', date, time); updatePreview(); } document.addEventListener("DOMContentLoaded", () => { setTimeout(() => { setAbrirAgora(); setFecharEm2h(); ["abre_date","abre_time","fecha_date","fecha_time"].forEach((id) => { const el = document.getElementById(id); if (el) { el.addEventListener("change", updatePreview); el.addEventListener("input", updatePreview); } }); const utcCheckbox = document.getElementById("use_utc"); if (utcCheckbox) { utcCheckbox.addEventListener("change", updatePreview); } updatePreview(); }, 100); }); </script> {% endblock %} 